{% extends 'base.html' %}
{% block content %}

<h1>Upcoming Events</h1>
{% if upcoming_events %}
    <ul class="event-list">
        {% for event in upcoming_events %}
        <li class="event-card">
            <h2><a href="{% url 'event_detail' event.pk %}">{{ event.title }}</a></h2>
            <p>{{ event.description|truncatewords:20 }}</p>
            <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y H:i" }}</p>
            <p><strong>Location:</strong> {{ event.location }}</p>

            {% if user.is_authenticated %}
                {% if event.registrations.filter(user=user).exists %}
                    <form action="{% url 'leave_event' event.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-leave">Leave</button>
                    </form>
                {% else %}
                    <form action="{% url 'join_event' event.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-join">Join</button>
                    </form>
                {% endif %}
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-login">Log in to join</a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No upcoming events.</p>
{% endif %}


<hr>
<h1>Past Events</h1>
{% if past_events %}
    <ul class="event-list">
        {% for event in past_events %}
        <li class="event-card past">
            <h2>{{ event.title }}</h2>
            <p>{{ event.description|truncatewords:20 }}</p>
            <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y H:i" }}</p>
            <p><strong>Location:</strong> {{ event.location }}</p>
        </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No past events yet.</p>
{% endif %}

{% endblock %}
