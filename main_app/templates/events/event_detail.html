{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
    <h2>{{ event.title }}</h2>
    <p><strong>Location:</strong> {{ event.location }}</p>
    <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y H:i" }}</p>
    <p><strong>Description:</strong> {{ event.description }}</p>

    <div id="map" style="width:100%; height:400px; margin-top:20px; border-radius:10px;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const map = L.map('map').setView([31.963158, 35.930359], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q={{ event.location }}`);
    const data = await response.json();

    if (data.length > 0) {
        const lat = parseFloat(data[0].lat);
        const lon = parseFloat(data[0].lon);

        map.setView([lat, lon], 14);
        L.marker([lat, lon])
            .addTo(map)
            .bindPopup(`<b>{{ event.title }}</b><br>{{ event.location }}`)
            .openPopup();
    }
});
</script>

{% endblock %}
